!function(){"use strict";const e=50,t=50,r=50,a=50,n=1600-a-t,o=1600-e-r,i=n+a+t,s=o+e+r,c=d3.select("body").append("tooltip_div").attr("class","tooltip").style("opacity",0).style("display","none"),l=e=>void 0!==e.properties?"<b>Cazul "+e.properties.case_no+"</b><br />"+("Bărbat"===e.properties.gender?"Bărbat":"Femeie"===e.properties.gender?"Femeie":"Gen nespecificat")+(null!=e.properties.age&&0!=e.properties.age?", "+e.properties.age:"")+(null!=e.properties.county&&""!=e.properties.county?", din  "+e.properties.county:"")+".<br />"+(null!=e.properties.status?"Status: "+("Vindecat"===e.properties.status?"vindecat":"Confirmat"===e.properties.status?"confirmat":"deces")+".<br />":"")+(null!==e.properties.healing_date?"Data recuperării: "+e.properties.healing_date+".<br />":"")+(null!==e.properties.reference&&""!==e.properties.reference?'Detalii: <a href="'+e.properties.reference+'" target= "_blank">aici</a>':""):e.name,d=e=>{const t=Math.hypot(e.target.x-e.source.x,e.target.y-e.source.y);return`\n      M${e.source.x},${e.source.y}\n      A${t},${t} 0 0,1 ${e.target.x},${e.target.y}\n    `},p=d3.scaleOrdinal(["var(--main-confirmate)","var(--main-recuperari","var(--main-decese)"]).domain(["Confirmat","Vindecat","Decedat"]),f=["#4cbf84","#8e6def","#c0c72d","#605fd6","#64bf44","#bc5fd4","#4ac66b","#c946a2","#9cbe3a","#5581f2","#e8ab24","#8575db","#f0cc6b","#4f8be2","#dd6227","#41d1e8","#e04845","#4bd1b1","#e14286","#6cad66","#dd6acc","#80a84c","#8567bb","#b6a546","#af8ee6","#c9793e","#5a90d4","#d84f59","#57c8c6","#d36272","#50a283","#d26d98","#8ba76d","#9b6bb2","#b59d58","#e6a2e7","#c98762","#59a3d0","#ca7b78","#9a97d2","#c382a5","#b872ad"],u=()=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",e=>e.is_country_of_infection?"black":e.parent&&e.parent.properties?p(e.parent.properties.status):e.properties?p(e.properties.status):"black"),y(p)},y=e=>{d3.select("#chart").select("svg").selectAll(".category-legend").attr("transform","translate(20,50)");const t=d3.legendColor().shape("path",d3.symbol().type(d3.symbolCircle).size(150)()).shapePadding(10).scale(e);d3.select(".category-legend").call(t)};let m,g,x,b,h={nodes:[],links:[]};d3.json("https://covid19.geo-spatial.org/api/statistics/getCaseRelations").then(e=>{m=e,v(),setTimeout(_(),100)});const v=()=>{const e=m.data.nodes.filter(e=>null!==e.properties.country_of_infection&&"România"!==e.properties.country_of_infection&&"Romania"!==e.properties.country_of_infection);h.nodes=m.data.nodes.concat(Array.from(new Set(e.map(e=>e.properties.country_of_infection)),e=>({name:e}))),h.links=m.data.links.concat(e.map(e=>({target:e.name,source:e.properties.country_of_infection})))},_=()=>{const t=d3.zoom().on("zoom",()=>{w.attr("transform",d3.event.transform)}),r=Array.from(new Set(h.nodes.filter(e=>e.properties).map(e=>e.properties&&e.properties.county))).sort((e,t)=>d3.ascending(e,t)),m=d3.scaleOrdinal(f).domain(r);d3.select("#switch-colors").on("click",(function(){var e=d3.select(this);"Colorează județe"===e.text()?((e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.parent&&t.parent.properties?e(t.parent.properties.county):t.properties?e(t.properties.county):""),y(e)})(m),e.text("Colorează status")):(u(),e.text("Colorează județe"))}));const v=Array.from(new Set(h.nodes.map(e=>e.properties?e.properties.case_no:"")));d3.select("#nRadius").property("max",d3.max(v));const _=e=>{d3.select("#nRadius-value").text(e),d3.select("#nRadius").property("value",e),d3.selectAll("circle").attr("r",5),d3.selectAll(".CO-"+e).attr("r",10)};d3.select("#nRadius").on("input",(function(){_(+this.value)})),_(1),g=d3.forceSimulation(h.nodes).force("link",d3.forceLink(h.links).id(e=>JSON.parse(JSON.stringify(e)).name)).force("charge",d3.forceManyBody().strength(-140).distanceMax(1400)).force("center",d3.forceCenter(n/2,o/2)).force("collision",d3.forceCollide().radius(e=>e.radius)).force("x",d3.forceX()).force("y",d3.forceY()).alphaDecay([.02]);const k=d3.select("#chart").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("width",i).attr("height",s).attr("viewBox","0, 0 "+i+" "+s).on("click",()=>{c.transition().duration(200).style("opacity",0)}),w=k.append("g").attr("transform","translate("+a+","+e+")"),A=Array.from(new Set(h.nodes.map(e=>e.source)));w.append("defs").selectAll("marker").data(A).join("marker").attr("id",e=>`arrow-${e}`).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill","#999").attr("d","M0,-5L10,0L0,5"),x=w.append("g").attr("class","link").selectAll("path").data(h.links).join("path").attr("marker-end",e=>`url(${new URL(`#arrow-${e.type}`,location.toString())})`),x.exit().remove(),b=w.append("g").attr("class","node").selectAll("g").data(h.nodes).join("g").call((e=>d3.drag().on("start",t=>{d3.event.active||e.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",e=>{e.fx=d3.event.x,e.fy=d3.event.y}).on("end",t=>{d3.event.active||e.alphaTarget(0),t.fx=null,t.fy=null}))(g));const C=(e=>{const t={};e.forEach((function(e){t[e.source.index+","+e.target.index]=1}));const r=(e,r)=>t[e.index+","+r.index]||t[r.index+","+e.index]||e.index==r.index;return(e,t,a)=>function(n){e.style("stroke-opacity",(function(e){return r(n,e)?1:a})),e.style("fill-opacity",(function(e){return r(n,e)?1:a})),t.style("stroke-opacity",(function(e){return e.source===n||e.target===n?1:a}))}})(h.links);b.append("circle").attr("class",e=>e.properties&&`CO-${e.properties.case_no}`).attr("r",5).on("touchmove mouseover",e=>{(e=>{if(e.is_country_of_infection)return;let t=d3.event.pageX-20,r=d3.event.pageY+20;window.innerWidth-t<150&&(t=d3.event.pageX-40),c.transition().duration(200).style("opacity",.9),c.html(l(e)).style("left",t+"px").style("top",r+"px").style("display",null)})(e)}).on("touchend mouseout",C(b,x,1)),b.append("text").attr("class","node-labels").attr("x",8).attr("y","0.31em").text(e=>e.is_country_of_infection?e.country_name:"#"+e.name).clone(!0).lower(),b.exit().remove(),g.on("tick",()=>{x.attr("d",d),b.attr("transform",e=>`translate(${e.x},${e.y})`)}),k.append("text").attr("class","title").attr("x",i/2).attr("y",20).text("Relația cazurilor confirmate"),u(),k.append("g").attr("class","category-legend"),y(p),t(k)}}();
//# sourceMappingURL=bundle.js.map
