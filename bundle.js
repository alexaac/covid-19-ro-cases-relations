!function(){"use strict";const e=50,t=50,a=50,r=50,s=window.innerWidth-t-r,n=window.innerHeight-e-a,o=s+t+r,i=n+e+a,l=d3.geoAlbers().center([24.7731,45.7909]).rotate([-14,3.3,-10]).parallels([37,54]).scale(5e3),c=(d3.geoPath().projection(l),d3.select("body").append("tooltip_div").attr("class","tooltip").style("opacity",0).style("display","none")),d=e=>void 0!==e.properties?"<b>Cazul "+e.properties.case_no+"</b><br />"+("Bărbat"===e.properties.gender?"Bărbat":"Femeie"===e.properties.gender?"Femeie":"Gen nespecificat")+(null!=e.properties.age&&0!=e.properties.age?", "+e.properties.age:"")+(null!=e.properties.county&&""!=e.properties.county?", din  "+e.properties.county:"")+".<br />"+(null!=e.properties.status?"Status: "+("Vindecat"===e.properties.status?"vindecat":"Confirmat"===e.properties.status?"confirmat":"deces")+".<br />":"")+(null!==e.properties.diagnostic_date?"Data confirmării: "+e.properties.diagnostic_date+".<br />":"")+(null!==e.properties.healing_date?"Data recuperării: "+e.properties.healing_date+".<br />":"")+(null!==e.properties.reference&&""!==e.properties.reference?'Detalii: <a href="'+e.properties.reference+'" target= "_blank">aici</a>':""):e.name,p=(e,t)=>d3.drag().on("start",a=>{"diagram"===t&&(d3.event.active||e.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y)}).on("drag",e=>{"diagram"===t&&(e.fx=d3.event.x,e.fy=d3.event.y)}).on("end",a=>{"diagram"===t&&(d3.event.active||e.alphaTarget(0),a.fx=null,a.fy=null)}),u=d3.scaleOrdinal(["var(--main-confirmate)","var(--main-recuperari)","var(--main-decese)"]).domain(["Confirmat","Vindecat","Decedat"]),f=d3.scaleOrdinal(["#e4588c","#35d394","#ba1ea8","#4caf1c","#1848ca","#aad42b","#9b85ff","#068400","#8b2487","#97ff8b","#d60042","#00ae87","#f94740","#48d3ff","#d17300","#5ea2ff","#cfb100","#53498f","#ffe353","#325383","#86a700","#ff9eeb","#007f30","#d9b6ff","#3b5c12","#89c2ff","#964000","#00bfbb","#ff6f54","#01aac6","#ffb65d","#008857","#ff8e90","#145f36","#952e31","#fffea6","#8e3440","#5a936f","#883d0c","#ffaf81","#34a6c2","#b09764","#458a18"]).domain(["ALBA","ARAD","ARGEȘ","BACĂU","BIHOR","BISTRIȚA-NĂSĂUD","BOTOȘANI","BRAȘOV","BRĂILA","BUCUREȘTI","BUZĂU","CARAȘ-SEVERIN","CLUJ","CONSTANȚA","COVASNA","CĂLĂRAȘI","DOLJ","DÂMBOVIȚA","GALAȚI","GIURGIU","GORJ","HARGHITA","HUNEDOARA","IALOMIȚA","IAȘI","ILFOV","NECUNOSCUT","MARAMUREȘ","MEHEDINȚI","MUREȘ","NEAMȚ","OLT","PRAHOVA","SATU MARE","SIBIU","SUCEAVA","SĂLAJ","TELEORMAN","TIMIȘ","TULCEA","VASLUI","VRANCEA","VÂLCEA"]),m=d3.scaleOrdinal(["var(--main-barbat)","var(--main-femeie)"]).domain(["Bărbat","Femeie"]),g=d3.scaleQuantile().domain([0,100]).range(d3.schemeSpectral[10]),y=()=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",e=>e.is_country_of_infection?"black":e.properties?u(e.properties.status):""),A("status-legend")},h=(e,t,a,r,s)=>{const n=d3.select("#legend-div").append("div").attr("class",r).append("svg").attr("class","category-legend").attr("width",110).attr("height",t).attr("preserveAspectRatio","xMidYMid").attr("viewBox","-10, -10 120 "+a).attr("x",0).attr("y",0),o=d3.legendColor().shape("path",d3.symbol().type(d3.symbolCircle).size(150)()).shapePadding(10).title(s).titleWidth(100).labelFormat(d3.format(".0f")).labelAlign("start").scale(e);n.call(o)},A=e=>{d3.select(".county-legend").classed("hide",!0),d3.select(".status-legend").classed("hide",!0),d3.select(".gender-legend").classed("hide",!0),d3.select(".age-legend").classed("hide",!0),"county-legend"===e?d3.select(".county-legend").classed("hide",!1):"status-legend"===e?d3.select(".status-legend").classed("hide",!1):"gender-legend"===e?d3.select(".gender-legend").classed("hide",!1):"age-legend"===e&&d3.select(".age-legend").classed("hide",!1)};let v,b,k,x,O,I,_,M,R,w,C,S={nodes:[],links:[]},E="diagram",B=!0,L=!0,U=!0,T=d3.timeParse("%d-%m-%Y"),N=[];const D=window.top.location.hash.substr(1),j=d3.timeFormatLocale({dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Luni","Marți","Miercuri","Joi","Vineri","Sâmbătă","Duminică"],shortDays:["Lu","Ma","Mi","Jo","Vi","Sa","Du"],months:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],shortMonths:["Ian","Feb","Mart","Apr","Mai","Iun","Iul","Aug","Sept","Oct","Nov","Dec"]}),z=j.format(".%L"),V=j.format(":%S"),$=j.format("%I:%M"),H=j.format("%I %p"),Y=j.format("%a %d"),F=j.format("%b %d"),G=j.format("%B"),J=j.format("%Y");function P(e){return(d3.timeSecond(e)<e?z:d3.timeMinute(e)<e?V:d3.timeHour(e)<e?$:d3.timeDay(e)<e?H:d3.timeMonth(e)<e?d3.timeWeek(e)<e?Y:F:d3.timeYear(e)<e?G:J)(e)}(()=>{let e,t={lines:9,length:4,width:5,radius:12,scale:1,corners:1,color:"#f40000",opacity:.25,rotate:0,direction:1,speed:1,trail:30,fps:20,zIndex:2e9,className:"spinner",shadow:!1,hwaccel:!1,position:"absolute"},a=document.getElementById("spinner");const r=[d3.json("data/judete_wgs84.json"),d3.json("https://covid19.geo-spatial.org/api/statistics/getCaseRelations")];Promise.all(r).then(r=>{O=r[0],x=r[1],e=new Spinner(t).spin(a),j(),setTimeout(z(),100)}).catch(e=>console.log(e));const j=()=>{x.data.nodes.filter(e=>null!==e.properties.country_of_infection&&"România"!==e.properties.country_of_infection&&"Romania"!==e.properties.country_of_infection);S.nodes=x.data.nodes,S.links=x.data.links,M=()=>{let e={};return S.nodes.forEach((function(t){e[t.name]=t})),e},w=()=>{let e={};return S.nodes.forEach((function(t){e[t.name]=[],S.links.forEach((function(a){a.source===t.name&&e[t.name].push(a.target)}))})),e},R=M(),C=w(),I="judete_wgs84",_=topojson.feature(O,O.objects[I]).features;let e=d3.map();_.forEach(t=>{let a=t.properties.county;e.set(a,{lat:t.properties.lat,lon:t.properties.lon})}),S.nodes.forEach(t=>{void 0!==t.properties&&(t.latitude=e.get(t.properties.county)&&e.get(t.properties.county).lat,t.longitude=e.get(t.properties.county)&&e.get(t.properties.county).lon,t.date=T(t.properties.diagnostic_date).getTime(),t.name=+t.name)}),S.nodes.sort((e,t)=>e.date-t.date),d3.nest().key((function(e){return e.properties.diagnostic_date})).entries(S.nodes).forEach((function(e){let t=[...e.values].sort((e,t)=>e.name-t.name),a=t.map((function(e){return e.dayOrder=t.indexOf(e)+1,e}));N.push(...a)})),S.nodes=N},z=()=>{const t=d3.zoom().scaleExtent([.2,10]).on("zoom",()=>{T.attr("transform",d3.event.transform)});d3.select("#zoom-in").on("click",()=>T.transition().call(t.scaleBy,2)),d3.select("#zoom-out").on("click",()=>T.transition().call(t.scaleBy,.5)),d3.select("#reset-zoom").on("click",()=>{T.transition().duration(750).call(t.transform,d3.zoomIdentity,d3.zoomTransform(T.node()).invert([o/2,i/2]))}),d3.select("#show-info").on("click",()=>a());const a=()=>{!0===L?(c.transition().duration(200).style("opacity",.9),c.html("<strong>Relația cazurilor confirmate</strong>.<br/><br/>Situaţia până la data în care s-au raportat oficial aceste informaţii.").style("left",o/2+"px").style("top",i/2+"px").style("display",null),L=!1):(c.transition().duration(200).style("opacity",0),L=!0)};h(u,300,300,"status-legend","Stare"),h(f,900,1100,"county-legend","Județ"),h(m,200,200,"gender-legend","Gen"),h(g,400,400,"age-legend","Vârstă"),A("status-legend"),d3.select("#color-counties").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?e(t.properties.county):""),A("county-legend")})(f)),d3.select("#color-status").on("click",()=>y()),d3.select("#color-gender").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.gender?"var(--main-null)":e(t.properties.gender):""),A("gender-legend")})(m)),d3.select("#color-age").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.age?"var(--main-null)":e(t.properties.age):""),A("age-legend")})(g));const r=d3.scaleTime().domain(d3.extent(S.nodes,(function(e){return e.date}))).range([0,o]),x=d3.scaleLinear().domain(d3.extent(S.nodes,(function(e){return e.dayOrder}))).range([i,0]),M=(e,t,a)=>{e.attr("d",e=>{if("arcs"===a){x(e.dayOrder);let t=r(R[e.source.name].date),a=r(R[e.target.name].date);return["M",t,x(R[e.source.name].dayOrder),"A",(t-a)/2,",",(t-a)/2,0,0,",",t<a?1:0,a,x(R[e.target.name].dayOrder)].join(" ")}return(e=>{const t=Math.hypot(e.target.x-e.source.x,e.target.y-e.source.y);return`\n    M${e.source.x},${e.source.y}\n    A${t},${t} 0 0,1 ${e.target.x},${e.target.y}\n    `})(e)}),t.attr("transform",e=>`translate(${e.x},${e.y})`)};v=d3.forceSimulation(S.nodes).force("link",d3.forceLink(S.links).id(e=>JSON.parse(JSON.stringify(e)).name)).force("charge",d3.forceManyBody().strength(-100).distanceMax(1e3)).force("center",d3.forceCenter(s/2,n/2)).force("x",d3.forceX()).force("y",d3.forceY()).alphaDecay([.02]),v.on("tick",()=>{M(b,k,E)}),v.force("link").links(S.links);const w=d3.select("#chart").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("width",o).attr("height",i).attr("viewBox","0, 0 "+o+" "+i).on("click",()=>{d3.selectAll("circle").attr("r",5),d3.selectAll("circle").style("opacity",1),d3.selectAll(".link").style("opacity",1),c.transition().duration(200).style("opacity",0)}),T=w.append("g"),N=T.append("g").attr("class","time-graph").attr("opacity",0);N.append("text").attr("y",i+50).attr("x",o/2).attr("font-size","16px").attr("text-anchor","middle").text("Ziua");N.append("g").attr("transform","translate(0,"+i+")").call(d3.axisBottom(r).ticks(20).tickFormat(P)).selectAll("text").attr("font-weight","bold").style("text-anchor","end").attr("dx","-.8em").attr("transform","rotate(-90)"),N.append("g").call(d3.axisLeft(x).ticks(10)).selectAll("text").attr("font-weight","bold");N.append("text").attr("transform","rotate(-90)").attr("y",-50).attr("x",-200).attr("font-size","20px").attr("text-anchor","middle").text("Order per day");const j=topojson.feature(O,{type:"GeometryCollection",geometries:O.objects[I].geometries}),z=d3.geoPath().projection(l.fitSize([o,i],j)),V=T.append("g").attr("class","map-features").selectAll("path").data(_).enter().append("path").attr("d",z).attr("class","land").attr("opacity",.25),$=Array.from(new Set(S.nodes.map(e=>e.source)));T.append("defs").selectAll("marker").data($).join("marker").attr("id",e=>`arrow-${e}`).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill","#999").attr("d","M0,-5L10,0L0,5"),b=T.append("g").attr("class","link").selectAll("path").data(S.links).join("path").attr("class",e=>`CO-links-${e.source.name}`).classed("links",!0).attr("marker-end",e=>`url(${new URL(`#arrow-${e.type}`,location.toString())})`),b.exit().remove(),k=T.append("g").attr("class","node").selectAll("g").data(S.nodes).join("g").call(p(v,E)),k.append("circle").attr("id",e=>e.properties&&`CO-${e.properties.case_no}`).attr("r",5).on("touchmove mouseover",(function(e){((e,t,a)=>{let r=d3.event.pageX-20,s=d3.event.pageY+20;window.innerWidth-r<150&&(r=d3.event.pageX-40),d3.selectAll("circle").attr("r",5).style("opacity",.3),d3.selectAll(".links").style("stroke","#999").style("opacity",.3),d3.selectAll(".node-labels").style("opacity",.3),c.transition().duration(200).style("opacity",.9),d3.select("#CO-"+e.name).attr("r",15).style("opacity",1),d3.selectAll(".CO-links-"+e.name).style("stroke","firebrick").transition().duration(500).attr("stroke-dashoffset",0).style("opacity",1).on("end",(function(e,a){0===a&&d3.selectAll("circle").filter((function(a){return t[e.source.name].includes(a.name)||+e.source.name==+a.name})).style("opacity","1"),d3.selectAll(".node-labels").filter((function(a){return t[e.source.name].includes(a.name)||+e.source.name==+a.name})).style("opacity","1")})),d3.selectAll(".CO-labels-"+e.name).style("color","firebrick").style("opacity",1);let n=a.indexOf(e.name);d3.select("#nRadius-value").text(e.name),d3.select("#nRadius").property("value",n),c.html(d(e)).style("left",r+"px").style("top",s+"px").style("display",null)})(e,C,F)})).on("touchend mouseout",e=>{}).on("click",e=>{d3.event.stopPropagation(),T.transition().duration(750).call(t.transform,d3.zoomIdentity.translate(s/2,n/2).translate(-e.x,-e.y))}),k.append("text").attr("class",e=>`CO-labels-${e.name}`).classed("node-labels",!0).attr("x",8).attr("y","0.31em").text(e=>e.is_country_of_infection?e.country_name:"#"+e.name).clone(!0).lower(),k.exit().remove(),y(),t(w);const H=(e,t)=>{"map"===e?S.nodes.forEach((function(e){const t=l([e.longitude,e.latitude]);e.x=t[0]||e.x,e.y=t[1]||e.y})):S.nodes.forEach((function(e){e.x=r(e.date),e.y=x(e.dayOrder)}));const a=d3.transition().duration(t?0:800).ease(d3.easeElastic.period(.5));M(b.transition(a),k.transition(a),e)};d3.select("#show-map").on("click",()=>(E="map",V.attr("opacity",1),N.attr("opacity",0),v.stop(),H(E,0),void k.call(p(v,E)))),d3.select("#show-graph").on("click",()=>(E="diagram",V.attr("opacity",.25),N.attr("opacity",0),v.alpha(1).restart(),void k.call(p(v,E)))),d3.select("#show-arcs").on("click",()=>(E="arcs",V.attr("opacity",0),N.attr("opacity",1),v.stop(),H(E,0),void k.call(p(v,E))));d3.select("#legend-div").classed("hide",!1),d3.select("#toggle-legend").on("click",()=>{!0===B?(d3.select("#legend-div").classed("hide",!0),B=!1):(d3.select("#legend-div").classed("hide",!1),B=!0)});let Y;d3.select("#search-case").on("click",()=>{!0===U?(d3.select("#search-input").classed("hide",!1),U=!1):(d3.select("#search-input").classed("hide",!0),U=!0)}),d3.select("#search-input").on("input",(function(){var e;e=+this.value,F.includes(e)&&(d3.selectAll("circle").attr("r",5),d3.select("#CO-"+e).attr("r",15).dispatch("mouseover").dispatch("click"))})),T.transition().call(t.scaleBy,.5),d3.select("#play-cases").on("click",()=>{d3.select("#play-cases").classed("hide",!0),d3.select("#pause-cases").classed("hide",!1),X()}),d3.select("#pause-cases").on("click",()=>{d3.select("#pause-cases").classed("hide",!0),d3.select("#play-cases").classed("hide",!1),Z()});const F=Array.from(new Set(S.nodes.map(e=>e.properties?+e.properties.case_no:"")));let G,J;d3.select("#nRadius").on("input",(function(){W(+this.value)})),d3.select("#nRadius").property("max",F.length-1);const W=e=>{d3.select("#nRadius-value").text(F[e]),d3.select("#nRadius").property("value",F[e]),d3.select("#search-input").property("value",F[e]),d3.selectAll("circle").attr("r",5),d3.select("#CO-"+F[e]).attr("r",15).dispatch("mouseover")};W(F.length-1);const X=()=>{T.transition().call(t.scaleBy,1),J=d3.select("#nRadius").node().value,+J==+F.length-1&&(J=0),Y=setInterval((function(){G=F[J],void 0!==G?(W(J),J++):clearInterval(Y)}),200)},Z=()=>{clearInterval(Y)};d3.select(".slider").attr("transform","translate(0,"+i+")"),void 0!==D&&("map"===D?d3.select("#show-map").dispatch("click"):"graph"===D?d3.select("#show-graph").dispatch("click"):"arcs"===D&&d3.select("#show-arcs").dispatch("click")),setTimeout((function(){v.stop(),e.stop(),d3.select("tooltip_div").classed("tooltip-abs",!0),d3.select("#CO-"+d3.max(F)).attr("r",15).dispatch("mouseover")}),5e3)}}).call(void 0)}();
//# sourceMappingURL=bundle.js.map
