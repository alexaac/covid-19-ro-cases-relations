!function(){"use strict";const e=50,t=50,a=50,r=50,n=window.innerWidth-t-r,o=window.innerHeight-e-a,s=n+t+r,i=o+e+a,l=d3.geoAlbers().center([24.7731,45.7909]).rotate([-14,3.3,-10]).parallels([37,54]).scale(5e3),c=(d3.geoPath().projection(l),d3.select("body").append("tooltip_div").attr("class","tooltip").style("opacity",0).style("display","none")),d=e=>void 0!==e.properties?"<b>Cazul "+e.properties.case_no+"</b><br />"+("Bărbat"===e.properties.gender?"Bărbat":"Femeie"===e.properties.gender?"Femeie":"Gen nespecificat")+(null!=e.properties.age&&0!=e.properties.age?", "+e.properties.age:"")+(null!=e.properties.county&&""!=e.properties.county?", din  "+e.properties.county:"")+".<br />"+(null!=e.properties.status?"Status: "+("Vindecat"===e.properties.status?"vindecat":"Confirmat"===e.properties.status?"confirmat":"deces")+".<br />":"")+(null!==e.properties.healing_date?"Data recuperării: "+e.properties.healing_date+".<br />":"")+(null!==e.properties.reference&&""!==e.properties.reference?'Detalii: <a href="'+e.properties.reference+'" target= "_blank">aici</a>':""):e.name,p=(e,t)=>d3.drag().on("start",a=>{"map"!==t&&(d3.event.active||e.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y)}).on("drag",e=>{"map"!==t&&(e.fx=d3.event.x,e.fy=d3.event.y)}).on("end",a=>{"map"!==t&&(d3.event.active||e.alphaTarget(0),a.fx=null,a.fy=null)}),f=e=>{const t=Math.hypot(e.target.x-e.source.x,e.target.y-e.source.y);return`\n      M${e.source.x},${e.source.y}\n      A${t},${t} 0 0,1 ${e.target.x},${e.target.y}\n    `},u=d3.scaleOrdinal(["var(--main-confirmate)","var(--main-recuperari)","var(--main-decese)"]).domain(["Confirmat","Vindecat","Decedat"]),g=d3.scaleOrdinal(["#e4588c","#35d394","#ba1ea8","#4caf1c","#1848ca","#aad42b","#9b85ff","#068400","#8b2487","#97ff8b","#d60042","#00ae87","#f94740","#48d3ff","#d17300","#5ea2ff","#cfb100","#53498f","#ffe353","#325383","#86a700","#ff9eeb","#007f30","#d9b6ff","#3b5c12","#89c2ff","#964000","#00bfbb","#ff6f54","#01aac6","#ffb65d","#008857","#ff8e90","#145f36","#952e31","#fffea6","#8e3440","#5a936f","#883d0c","#ffaf81","#34a6c2","#b09764","#458a18"]).domain(["ALBA","ARAD","ARGEȘ","BACĂU","BIHOR","BISTRIȚA-NĂSĂUD","BOTOȘANI","BRAȘOV","BRĂILA","BUCUREȘTI","BUZĂU","CARAȘ-SEVERIN","CLUJ","CONSTANȚA","COVASNA","CĂLĂRAȘI","DOLJ","DÂMBOVIȚA","GALAȚI","GIURGIU","GORJ","HARGHITA","HUNEDOARA","IALOMIȚA","IAȘI","ILFOV","NECUNOSCUT","MARAMUREȘ","MEHEDINȚI","MUREȘ","NEAMȚ","OLT","PRAHOVA","SATU MARE","SIBIU","SUCEAVA","SĂLAJ","TELEORMAN","TIMIȘ","TULCEA","VASLUI","VRANCEA","VÂLCEA"]),m=d3.scaleOrdinal(["var(--main-barbat)","var(--main-femeie)"]).domain(["Bărbat","Femeie"]),y=d3.scaleQuantile().domain([0,100]).range(d3.schemeSpectral[10]),h=()=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",e=>e.is_country_of_infection?"black":e.properties?u(e.properties.status):""),v("status-legend")},A=(e,t,a,r,n)=>{const o=d3.select("#legend-div").append("div").attr("class",r).append("svg").attr("class","category-legend").attr("width",110).attr("height",t).attr("preserveAspectRatio","xMidYMid").attr("viewBox","-10, -10 120 "+a).attr("x",0).attr("y",0),s=d3.legendColor().shape("path",d3.symbol().type(d3.symbolCircle).size(150)()).shapePadding(10).title(n).titleWidth(100).labelFormat(d3.format(".0f")).labelAlign("start").scale(e);o.call(s)},v=e=>{d3.select(".county-legend").classed("hide",!0),d3.select(".status-legend").classed("hide",!0),d3.select(".gender-legend").classed("hide",!0),d3.select(".age-legend").classed("hide",!0),"county-legend"===e?d3.select(".county-legend").classed("hide",!1):"status-legend"===e?d3.select(".status-legend").classed("hide",!1):"gender-legend"===e?d3.select(".gender-legend").classed("hide",!1):"age-legend"===e&&d3.select(".age-legend").classed("hide",!1)};let x,b,k,_,R,I,w,C={nodes:[],links:[]},E=!0,O=!0;(()=>{let e,t={lines:9,length:4,width:5,radius:12,scale:1,corners:1,color:"#f40000",opacity:.25,rotate:0,direction:1,speed:1,trail:30,fps:20,zIndex:2e9,className:"spinner",shadow:!1,hwaccel:!1,position:"absolute"},a=document.getElementById("spinner");const r=[d3.json("data/judete_wgs84.json"),d3.json("https://covid19.geo-spatial.org/api/statistics/getCaseRelations")];Promise.all(r).then(r=>{R=r[0],_=r[1],e=new Spinner(t).spin(a),S(),setTimeout(B(),100)}).catch(e=>console.log(e));const S=()=>{const e=_.data.nodes.filter(e=>null!==e.properties.country_of_infection&&"România"!==e.properties.country_of_infection&&"Romania"!==e.properties.country_of_infection);C.nodes=_.data.nodes.concat(Array.from(new Set(e.map(e=>e.properties.country_of_infection)),e=>({name:e}))),C.links=_.data.links.concat(e.map(e=>({target:e.name,source:e.properties.country_of_infection}))),I="judete_wgs84",w=topojson.feature(R,R.objects[I]).features;let t=d3.map();w.forEach(e=>{let a=e.properties.county;t.set(a,{lat:e.properties.lat,lon:e.properties.lon})}),C.nodes.forEach(e=>{void 0!==e.properties&&(e.latitude=t.get(e.properties.county)&&t.get(e.properties.county).lat,e.longitude=t.get(e.properties.county)&&t.get(e.properties.county).lon)})},B=()=>{const t=d3.zoom().scaleExtent([.2,10]).on("zoom",()=>{U.attr("transform",d3.event.transform)});d3.select("#zoom-in").on("click",()=>U.transition().call(t.scaleBy,2)),d3.select("#zoom-out").on("click",()=>U.transition().call(t.scaleBy,.5)),d3.select("#reset-zoom").on("click",()=>{U.transition().duration(750).call(t.transform,d3.zoomIdentity,d3.zoomTransform(U.node()).invert([s/2,i/2]))}),d3.select("#show-info").on("click",()=>a());const a=()=>{!0===O?(c.transition().duration(200).style("opacity",.9),c.html("<strong>Relația cazurilor confirmate</strong>.<br/><br/>Situaţia până la data în care s-au raportat oficial aceste informaţii.").style("left",s/2+"px").style("top",i/2+"px").style("display",null),O=!1):(c.transition().duration(200).style("opacity",0),O=!0)};A(u,300,300,"status-legend","Stare"),A(g,900,1100,"county-legend","Județ"),A(m,200,200,"gender-legend","Gen"),A(y,400,400,"age-legend","Vârstă"),v("status-legend"),d3.select("#color-counties").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?e(t.properties.county):""),v("county-legend")})(g)),d3.select("#color-status").on("click",()=>h()),d3.select("#color-gender").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.gender?"var(--main-null)":e(t.properties.gender):""),v("gender-legend")})(m)),d3.select("#color-age").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.age?"var(--main-null)":e(t.properties.age):""),v("age-legend")})(y));const r=Array.from(new Set(C.nodes.map(e=>e.properties?e.properties.case_no:"")));d3.select("#nRadius").property("max",d3.max(r));const _=e=>{r.includes(e)&&(d3.select("#nRadius-value").text(e),d3.select("#nRadius").property("value",e),d3.selectAll("circle").attr("r",5),d3.select("#CO-"+e).attr("r",15).dispatch("mouseover").dispatch("click"))};d3.select("#nRadius").on("input",(function(){_(+this.value)})),_(d3.max(r));const S=(e,t)=>{e.attr("d",f),t.attr("transform",e=>`translate(${e.x},${e.y})`)};x=d3.forceSimulation(C.nodes).force("link",d3.forceLink(C.links).id(e=>JSON.parse(JSON.stringify(e)).name)).force("charge",d3.forceManyBody().strength(-100).distanceMax(1e3)).force("center",d3.forceCenter(n/2,o/2)).force("x",d3.forceX()).force("y",d3.forceY()).alphaDecay([.02]),x.on("tick",()=>{S(b,k)}),x.force("link").links(C.links);const B=d3.select("#chart").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("width",s).attr("height",i).attr("viewBox","0, 0 "+s+" "+i).on("click",()=>{d3.selectAll("circle").attr("r",5),c.transition().duration(200).style("opacity",0)}),U=B.append("g"),M=topojson.feature(R,{type:"GeometryCollection",geometries:R.objects[I].geometries}),L=d3.geoPath().projection(l.fitSize([n,o],M)),N=U.append("g").attr("class","map-features").selectAll("path").data(w).enter().append("path").attr("d",L).attr("class","land").attr("opacity",.25),T=Array.from(new Set(C.nodes.map(e=>e.source)));U.append("defs").selectAll("marker").data(T).join("marker").attr("id",e=>`arrow-${e}`).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill","#999").attr("d","M0,-5L10,0L0,5"),b=U.append("g").attr("class","link").selectAll("path").data(C.links).join("path").attr("marker-end",e=>`url(${new URL(`#arrow-${e.type}`,location.toString())})`),b.exit().remove(),k=U.append("g").attr("class","node").selectAll("g").data(C.nodes).join("g").call(p(x,"diagram"));(e=>{const t={};e.forEach((function(e){t[e.source.index+","+e.target.index]=1}));const a=(e,a)=>t[e.index+","+a.index]||t[a.index+","+e.index]||e.index==a.index})(C.links);k.append("circle").attr("id",e=>e.properties&&`CO-${e.properties.case_no}`).attr("r",5).on("touchmove mouseover",e=>{(e=>{let t=d3.event.pageX-20,a=d3.event.pageY+20;window.innerWidth-t<150&&(t=d3.event.pageX-40),d3.selectAll("circle").attr("r",5),c.transition().duration(200).style("opacity",.9),d3.select("#CO-"+e.name).attr("r",15),d3.select("#nRadius-value").text(e.name),d3.select("#nRadius").property("value",e.name),c.html(d(e)).style("left",t+"px").style("top",a+"px").style("display",null)})(e)}).on("click",e=>{d3.event.stopPropagation(),U.transition().duration(750).call(t.transform,d3.zoomIdentity.translate(n/2,o/2).translate(-e.x,-e.y))}),k.append("text").attr("class","node-labels").attr("x",8).attr("y","0.31em").text(e=>e.is_country_of_infection?e.country_name:"#"+e.name).clone(!0).lower(),k.exit().remove(),h(),t(B);const j=e=>{"diagram"===e?(e="map",N.attr("opacity",1),x.stop(),(e=>{C.nodes.forEach((function(e){const t=l([e.longitude,e.latitude]);e.x=t[0]||e.x,e.y=t[1]||e.y}));const t=d3.transition().duration(e?0:800).ease(d3.easeElastic.period(.5));S(b.transition(t),k.transition(t))})()):(e="diagram",N.attr("opacity",.25),x.alpha(1).restart()),k.call(p(x,e))};d3.select("#show-map").on("click",()=>j("diagram")),d3.select("#show-graph").on("click",()=>j("map"));d3.select("#legend-div").classed("hide",!1),d3.select("#toggle-legend").on("click",()=>{!0===E?(d3.select("#legend-div").classed("hide",!0),E=!1):(d3.select("#legend-div").classed("hide",!1),E=!0)}),U.transition().call(t.scaleBy,.5),setTimeout((function(){x.stop(),e.stop(),d3.select("tooltip_div").classed("tooltip-abs",!0),d3.select("#CO-"+d3.max(r)).attr("r",15).dispatch("mouseover").dispatch("click")}),5e3)}}).call(void 0)}();
//# sourceMappingURL=bundle.js.map
