!function(){"use strict";const e=50,t=50,a=50,r=50,n=window.innerWidth-t-r,s=window.innerHeight-e-a,o=n+t+r,i=s+e+a,l=d3.geoAlbers().center([24.7731,45.7909]).rotate([-14,3.3,-10]).parallels([37,54]).scale(5e3),c=(d3.geoPath().projection(l),d3.select("body").append("tooltip_div").attr("class","tooltip").style("opacity",0).style("display","none")),d=e=>void 0!==e.properties?"<b>Cazul "+e.properties.case_no+"</b><br />"+("Bărbat"===e.properties.gender?"Bărbat":"Femeie"===e.properties.gender?"Femeie":"Gen nespecificat")+(null!=e.properties.age&&0!=e.properties.age?", "+e.properties.age:"")+(null!=e.properties.county&&""!=e.properties.county?", din  "+e.properties.county:"")+".<br />"+(null!=e.properties.status?"Status: "+("Vindecat"===e.properties.status?"vindecat":"Confirmat"===e.properties.status?"confirmat":"deces")+".<br />":"")+(null!==e.properties.diagnostic_date?"Data confirmării: "+e.properties.diagnostic_date+".<br />":"")+(null!==e.properties.healing_date?"Data recuperării: "+e.properties.healing_date+".<br />":"")+(null!==e.properties.country_of_infection&&"România"!==e.properties.country_of_infection&&"Romania"!==e.properties.country_of_infection?"Țara de infectare: "+e.properties.country_of_infection+".<br />":"")+(null!==e.properties.reference&&""!==e.properties.reference?'Detalii: <a href="'+e.properties.reference+'" target= "_blank">aici</a>':""):e.name,p=(e,t)=>d3.drag().on("start",a=>{"diagram"===t&&(d3.event.active||e.alphaTarget(.3).restart(),a.fx=a.x,a.fy=a.y)}).on("drag",e=>{"diagram"===t&&(e.fx=d3.event.x,e.fy=d3.event.y)}).on("end",a=>{"diagram"===t&&(d3.event.active||e.alphaTarget(0),a.fx=null,a.fy=null)}),u=e=>{const t=Math.hypot(e.target.x-e.source.x,e.target.y-e.source.y);return`\n    M${e.source.x},${e.source.y}\n    A${t},${t} 0 0,1 ${e.target.x},${e.target.y}\n    `},f=d3.scaleOrdinal(["var(--main-confirmate)","var(--main-recuperari)","var(--main-decese)"]).domain(["Confirmat","Vindecat","Decedat"]),m=d3.scaleOrdinal(["#e4588c","#35d394","#ba1ea8","#4caf1c","#1848ca","#aad42b","#9b85ff","#068400","#8b2487","#97ff8b","#d60042","#00ae87","#f94740","#48d3ff","#d17300","#5ea2ff","#cfb100","#53498f","#ffe353","#325383","#86a700","#ff9eeb","#007f30","#d9b6ff","#3b5c12","#89c2ff","#964000","#00bfbb","#ff6f54","#01aac6","#ffb65d","#008857","#ff8e90","#145f36","#952e31","#fffea6","#8e3440","#5a936f","#883d0c","#ffaf81","#34a6c2","#b09764","#458a18"]).domain(["ALBA","ARAD","ARGEȘ","BACĂU","BIHOR","BISTRIȚA-NĂSĂUD","BOTOȘANI","BRAȘOV","BRĂILA","BUCUREȘTI","BUZĂU","CARAȘ-SEVERIN","CLUJ","CONSTANȚA","COVASNA","CĂLĂRAȘI","DOLJ","DÂMBOVIȚA","GALAȚI","GIURGIU","GORJ","HARGHITA","HUNEDOARA","IALOMIȚA","IAȘI","ILFOV","NECUNOSCUT","MARAMUREȘ","MEHEDINȚI","MUREȘ","NEAMȚ","OLT","PRAHOVA","SATU MARE","SIBIU","SUCEAVA","SĂLAJ","TELEORMAN","TIMIȘ","TULCEA","VASLUI","VRANCEA","VÂLCEA"]),g=d3.scaleOrdinal(["var(--main-barbat)","var(--main-femeie)"]).domain(["Bărbat","Femeie"]),y=d3.scaleQuantile().domain([0,100]).range(d3.schemeSpectral[10]),h=()=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",e=>e.is_country_of_infection?"black":e.properties?f(e.properties.status):""),v("status-legend")},A=(e,t,a,r,n)=>{const s=d3.select("#legend-div").append("div").attr("class",r).append("svg").attr("class","category-legend").attr("width",110).attr("height",t).attr("preserveAspectRatio","xMidYMid").attr("viewBox","-10, -10 120 "+a).attr("x",0).attr("y",0),o=d3.legendColor().shape("path",d3.symbol().type(d3.symbolCircle).size(150)()).shapePadding(10).title(n).titleWidth(100).labelFormat(d3.format(".0f")).labelAlign("start").scale(e);s.call(o)},v=e=>{d3.select(".county-legend").classed("hide",!0),d3.select(".status-legend").classed("hide",!0),d3.select(".gender-legend").classed("hide",!0),d3.select(".age-legend").classed("hide",!0),"county-legend"===e?d3.select(".county-legend").classed("hide",!1):"status-legend"===e?d3.select(".status-legend").classed("hide",!1):"gender-legend"===e?d3.select(".gender-legend").classed("hide",!1):"age-legend"===e&&d3.select(".age-legend").classed("hide",!1)};let b,k,x,_,I,O,R,M,C,S,w,E,B={nodes:[],links:[]},L="diagram",U=!0,T=!0,N=!0,z=d3.timeParse("%d-%m-%Y"),D=[];const j=d3.timeFormatLocale({dateTime:"%A, %e %B %Y г. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Luni","Marți","Miercuri","Joi","Vineri","Sâmbătă","Duminică"],shortDays:["Lu","Ma","Mi","Jo","Vi","Sa","Du"],months:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],shortMonths:["Ian","Feb","Mart","Apr","Mai","Iun","Iul","Aug","Sept","Oct","Nov","Dec"]}),V=j.format(".%L"),$=j.format(":%S"),H=j.format("%I:%M"),Y=j.format("%I %p"),F=j.format("%a %d"),G=j.format("%b %d"),J=j.format("%B"),P=j.format("%Y");function W(e){return(d3.timeSecond(e)<e?V:d3.timeMinute(e)<e?$:d3.timeHour(e)<e?H:d3.timeDay(e)<e?Y:d3.timeMonth(e)<e?d3.timeWeek(e)<e?F:G:d3.timeYear(e)<e?J:P)(e)}(()=>{let e,t={lines:9,length:4,width:5,radius:12,scale:1,corners:1,color:"#f40000",opacity:.25,rotate:0,direction:1,speed:1,trail:30,fps:20,zIndex:2e9,className:"spinner",shadow:!1,hwaccel:!1,position:"absolute"},a=document.getElementById("spinner");const r=[d3.json("data/judete_wgs84.json"),d3.json("https://covid19.geo-spatial.org/api/statistics/getCaseRelations")];Promise.all(r).then(r=>{I=r[0],_=r[1],e=new Spinner(t).spin(a),j(),setTimeout(V(),100)}).catch(e=>console.log(e));const j=()=>{const e=_.data.nodes.filter(e=>null!==e.properties.country_of_infection&&"România"!==e.properties.country_of_infection&&"Romania"!==e.properties.country_of_infection);B.nodes=_.data.nodes,B.links=_.data.links,E=Array.from(new Set(B.nodes.map(e=>e.properties?+e.properties.case_no:""))),B.nodes=B.nodes.concat(Array.from(new Set(e.map(e=>e.properties.country_of_infection)),e=>({name:e}))),B.links=B.links.concat(e.map(e=>({target:e.name,source:e.properties.country_of_infection}))),M=()=>{let e={};return B.nodes.forEach((function(t){e[t.name]=t})),e},S=()=>{let e={};return B.nodes.forEach((function(t){e[t.name]=[],B.links.forEach((function(a){a.source===t.name&&e[t.name].push(a.target)}))})),e},C=M(),w=S(),O="judete_wgs84",R=topojson.feature(I,I.objects[O]).features;let t=d3.map();R.forEach(e=>{let a=e.properties.county;t.set(a,{lat:e.properties.lat,lon:e.properties.lon})}),B.nodes.forEach(e=>{void 0!==e.properties&&(e.latitude=t.get(e.properties.county)&&t.get(e.properties.county).lat,e.longitude=t.get(e.properties.county)&&t.get(e.properties.county).lon,e.date=z(e.properties.diagnostic_date).getTime(),e.name=+e.name)}),B.nodes.sort((e,t)=>e.date-t.date),d3.nest().key((function(e){return e.properties&&e.properties.diagnostic_date})).entries(B.nodes).forEach((function(e){let t=[...e.values].sort((e,t)=>e.name-t.name),a=t.map((function(e){return e.dayOrder=t.indexOf(e)+1,e}));D.push(...a)})),B.nodes=D},V=()=>{const t=d3.zoom().scaleExtent([.2,10]).on("zoom",()=>{z.attr("transform",d3.event.transform)});d3.select("#zoom-in").on("click",()=>z.transition().call(t.scaleBy,2)),d3.select("#zoom-out").on("click",()=>z.transition().call(t.scaleBy,.5)),d3.select("#reset-zoom").on("click",()=>{z.transition().duration(750).call(t.transform,d3.zoomIdentity,d3.zoomTransform(z.node()).invert([o/2,i/2]))}),d3.select("#show-info").on("click",()=>a());const a=()=>{!0===T?(c.transition().duration(200).style("opacity",.9),c.html("<strong>Relația cazurilor confirmate</strong>.<br/><br/>Situaţia până la data în care s-au raportat oficial aceste informaţii.").style("left",o/2+"px").style("top",i/2+"px").style("display",null),T=!1):(c.transition().duration(200).style("opacity",0),T=!0)};A(f,300,300,"status-legend","Stare"),A(m,900,1100,"county-legend","Județ"),A(g,200,200,"gender-legend","Gen"),A(y,400,400,"age-legend","Vârstă"),v("status-legend"),d3.select("#color-counties").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?e(t.properties.county):""),v("county-legend")})(m)),d3.select("#color-status").on("click",()=>h()),d3.select("#color-gender").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.gender?"var(--main-null)":e(t.properties.gender):""),v("gender-legend")})(g)),d3.select("#color-age").on("click",()=>(e=>{d3.select("#chart").select("svg").selectAll("circle").transition().duration(100).attr("fill",t=>t.is_country_of_infection?"black":t.properties?null===t.properties.age?"var(--main-null)":e(t.properties.age):""),v("age-legend")})(y));const r=d3.scaleTime().domain(d3.extent(B.nodes,(function(e){return e.date}))).range([0,o]),_=d3.scaleLinear().domain(d3.extent(B.nodes,(function(e){return e.dayOrder}))).range([i,0]),M=(e,t,a)=>{e.attr("d",e=>{if("arcs"===a){if("string"==typeof e.source.name)return u(e);{let t=r(C[e.source.name].date)||0,a=r(C[e.target.name].date);return["M",t,_(C[e.source.name].dayOrder),"A",(t-a)/2,",",(t-a)/2,0,0,",",t<a?1:0,a,_(C[e.target.name].dayOrder)].join(" ")}}return u(e)}),t.attr("transform",e=>`translate(${e.x},${e.y})`)};b=d3.forceSimulation(B.nodes).force("link",d3.forceLink(B.links).id(e=>JSON.parse(JSON.stringify(e)).name)).force("charge",d3.forceManyBody().strength(-100).distanceMax(1e3)).force("center",d3.forceCenter(n/2,s/2)).force("x",d3.forceX()).force("y",d3.forceY()).alphaDecay([.02]),b.on("tick",()=>{M(k,x,L)}),b.force("link").links(B.links);const S=d3.select("#chart").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("width",o).attr("height",i).attr("viewBox","0, 0 "+o+" "+i).on("click",()=>{d3.selectAll("circle").attr("r",5),d3.selectAll("circle").style("opacity",1),d3.selectAll(".link").style("opacity",1),d3.selectAll(".node-labels").style("opacity","1"),c.transition().duration(200).style("opacity",0)}),z=S.append("g"),D=z.append("g").attr("class","time-graph").attr("opacity",0);D.append("text").attr("y",i+70).attr("x",o/2).attr("font-size","16px").attr("text-anchor","middle").text("Ziua");D.append("g").attr("transform","translate(0,"+i+")").call(d3.axisBottom(r).ticks(20).tickFormat(W)).selectAll("text").attr("font-weight","bold").style("text-anchor","end").attr("dx","-.8em").attr("transform","rotate(-65)"),D.append("g").call(d3.axisLeft(_).ticks(10)).selectAll("text").attr("font-weight","bold");D.append("text").attr("transform","rotate(-90)").attr("y",-50).attr("x",-i/2).attr("font-size","20px").attr("text-anchor","middle").text("Cazuri pe zi");const j=topojson.feature(I,{type:"GeometryCollection",geometries:I.objects[O].geometries}),V=d3.geoPath().projection(l.fitSize([o,i],j)),$=z.append("g").attr("class","map-features").selectAll("path").data(R).enter().append("path").attr("d",V).attr("class","land").attr("opacity",.25),H=Array.from(new Set(B.nodes.map(e=>e.source)));z.append("defs").selectAll("marker").data(H).join("marker").attr("id",e=>`arrow-${e}`).attr("viewBox","0 -5 10 10").attr("refX",15).attr("refY",-.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill","#999").attr("d","M0,-5L10,0L0,5"),k=z.append("g").attr("class","link").selectAll("path").data(B.links).join("path").attr("class",e=>`CO-links-${e.source.name}`).classed("links",!0).attr("marker-end",e=>`url(${new URL(`#arrow-${e.type}`,location.toString())})`),k.exit().remove(),x=z.append("g").attr("class","node").selectAll("g").data(B.nodes).join("g").call(p(b,L)),x.append("circle").attr("id",e=>e.properties&&`CO-${e.properties.case_no}`).attr("r",5).on("touchmove mouseover",(function(e){((e,t,a)=>{let r=d3.event.pageX-20,n=d3.event.pageY+20;window.innerWidth-r<150&&(r=d3.event.pageX-40),d3.selectAll("circle").attr("r",5).style("opacity",.3),d3.selectAll(".links").style("stroke","#999").style("opacity",.3),d3.selectAll(".node-labels").style("opacity",.3),c.transition().duration(200).style("opacity",.9),d3.select("#CO-"+e.name).attr("r",15).style("opacity",1),d3.selectAll(".CO-links-"+e.name).style("stroke","firebrick").transition().duration(500).attr("stroke-dashoffset",0).style("opacity",1).on("end",(function(e,a){0===a&&d3.selectAll("circle").filter((function(a){return t[e.source.name].includes(a.name)||+e.source.name==+a.name})).style("opacity","1"),d3.selectAll(".node-labels").filter((function(a){return t[e.source.name].includes(a.name)||+e.source.name==+a.name})).style("opacity","1")})),d3.selectAll(".CO-labels-"+e.name).style("color","firebrick").style("opacity",1);let s=a.indexOf(e.name);d3.select("#nRadius-value").text(e.name),d3.select("#nRadius").property("value",s),c.html(d(e)).style("left",r+"px").style("top",n+"px").style("display",null)})(e,w,E)})).on("touchend mouseout",e=>{}).on("click",e=>{d3.event.stopPropagation(),z.transition().duration(750).call(t.transform,d3.zoomIdentity.translate(n/2,s/2).translate(-e.x,-e.y))}),x.append("text").attr("class",e=>`CO-labels-${e.name}`).classed("node-labels",!0).attr("x",8).attr("y","0.31em").text(e=>e.name).clone(!0).lower(),x.exit().remove(),h(),t(S);const Y=(e,t)=>{"map"===e?B.nodes.forEach((function(e){const t=l([e.longitude,e.latitude]);e.x=t[0]||e.x,e.y=t[1]||e.y})):B.nodes.forEach((function(e){e.x=r(e.date)||-100,e.y=_(e.dayOrder)}));const a=d3.transition().duration(t?0:800).ease(d3.easeElastic.period(.5));M(k.transition(a),x.transition(a),e)};d3.select("#show-map").on("click",()=>(L="map",$.attr("opacity",1),D.attr("opacity",0),b.stop(),Y(L,0),void x.call(p(b,L)))),d3.select("#show-graph").on("click",()=>(L="diagram",$.attr("opacity",.25),D.attr("opacity",0),b.alpha(1).restart(),void x.call(p(b,L)))),d3.select("#show-arcs").on("click",()=>(L="arcs",$.attr("opacity",0),D.attr("opacity",1),b.stop(),Y(L,0),void x.call(p(b,L))));d3.select("#legend-div").classed("hide",!1),d3.select("#toggle-legend").on("click",()=>{!0===U?(d3.select("#legend-div").classed("hide",!0),U=!1):(d3.select("#legend-div").classed("hide",!1),U=!0)});let F,G,J;d3.select("#search-case").on("click",()=>{!0===N?(d3.select("#search-input").classed("hide",!1),N=!1):(d3.select("#search-input").classed("hide",!0),N=!0)}),d3.select("#search-input").on("input",(function(){var e;e=+this.value,E.includes(e)&&(d3.selectAll("circle").attr("r",5),d3.select("#CO-"+e).attr("r",15).dispatch("mouseover").dispatch("click"))})),z.transition().call(t.scaleBy,.5),d3.select("#play-cases").on("click",()=>{d3.select("#play-cases").classed("hide",!0),d3.select("#pause-cases").classed("hide",!1),X()}),d3.select("#pause-cases").on("click",()=>{d3.select("#pause-cases").classed("hide",!0),d3.select("#play-cases").classed("hide",!1),Z()}),d3.select("#nRadius").on("input",(function(){P(+this.value)})),d3.select("#nRadius").property("max",E.length-1);const P=e=>{d3.select("#nRadius-value").text(E[e]),d3.select("#nRadius").property("value",E[e]),d3.select("#search-input").property("value",E[e]),d3.selectAll("circle").attr("r",5),d3.select("#CO-"+E[e]).attr("r",15).dispatch("mouseover")};P(E.length-1);const X=()=>{z.transition().call(t.scaleBy,1),J=d3.select("#nRadius").node().value,+J==+E.length-1&&(J=0),F=setInterval((function(){G=E[J],void 0!==G?(P(J),J++):J=0}),200)},Z=()=>{clearInterval(F)};d3.select(".slider").attr("transform","translate(0,"+i+")"),setTimeout((function(){b.stop(),e.stop(),d3.select("tooltip_div").classed("tooltip-abs",!0),d3.select("#CO-"+d3.max(E)).attr("r",15).dispatch("mouseover")}),5e3)}}).call(void 0)}();
//# sourceMappingURL=bundle.js.map
